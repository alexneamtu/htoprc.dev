name = "htoprc-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Development settings
[dev]
port = 8787

# Local D1 database for development
[[d1_databases]]
binding = "DB"
database_name = "htoprc-db-dev"
database_id = "local"

# ============================================
# Preview Environment (for PR previews)
# ============================================
[env.preview]
# Name is overridden via --name flag to htoprc-api-pr-{number}
# No routes - only accessible via workers.dev subdomain

[[env.preview.d1_databases]]
binding = "DB"
database_name = "htoprc-db-staging"
database_id = "8b9b25a5-60bc-44f8-9645-b19c414cdc6e"

# ============================================
# Staging Environment
# ============================================
[env.staging]
name = "htoprc-api-staging"
routes = [
  { pattern = "api-staging.htoprc.dev", custom_domain = true }
]

[env.staging.vars]
BASE_URL = "https://staging.htoprc.dev"

[[env.staging.d1_databases]]
binding = "DB"
database_name = "htoprc-db-staging"
database_id = "8b9b25a5-60bc-44f8-9645-b19c414cdc6e"

# ============================================
# Production Environment
# ============================================
[env.production]
name = "htoprc-api-production"
routes = [
  { pattern = "api.htoprc.dev", custom_domain = true }
]

[[env.production.d1_databases]]
binding = "DB"
database_name = "htoprc-db-production"
database_id = "d8bb5f13-2042-458a-a8e6-75cd4cd587d6"

# Cron trigger for scheduled scraping (daily at 3am UTC)
[env.production.triggers]
crons = ["0 3 * * *"]

# ============================================
# Shared Configuration Notes
# ============================================
# Environment variables (set via wrangler secret)
# CLERK_SECRET_KEY
# ANON_RATE_LIMIT_SALT
# GITHUB_TOKEN (required for GitHub scraper)
